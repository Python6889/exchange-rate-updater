name: 沪港通汇率每日更新

on:
  schedule:
    # 每天0点执行（UTC时间16:00 = 北京时间0:00）
    # 格式：分钟 小时 日 月 星期
    - cron: '0 16 * * *'
  
  # 允许手动触发（用于测试）
  workflow_dispatch:
    inputs:
      reason:
        description: '手动触发原因'
        required: false
        default: '测试运行'

jobs:
  update-exchange-rate:
    runs-on: ubuntu-latest  # 使用最新的Ubuntu系统
    
    steps:
    # 第一步：获取代码
    - name: 检出代码
      uses: actions/checkout@v3
      
    # 第二步：设置Python环境
    - name: 设置Python环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    # 第三步：安装依赖
    - name: 安装依赖
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    # 第四步：运行汇率更新程序
    - name: 运行汇率更新程序
      env:
        APP_ID: ${{ secrets.APP_ID }}
        APP_SECRET: ${{ secrets.APP_SECRET }}
        TABLE_TOKEN: ${{ secrets.TABLE_TOKEN }}
        SHEET_ID: ${{ secrets.SHEET_ID }}
      run: |
        echo "开始运行汇率更新程序..."
        python exchange_rate_update.py
        
    # 第五步：记录运行时间
    - name: 记录完成时间
      if: always()
      run: |
        echo "任务执行完成时间：$(date)"
        echo "GitHub Actions运行完成"
